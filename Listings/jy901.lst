C51 COMPILER V9.60.0.0   JY901                                                             04/13/2021 19:30:18 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE JY901
OBJECT MODULE PLACED IN .\Objects\jy901.obj
COMPILER INVOKED BY: E:\KEIL5\C51\BIN\C51.EXE Core\Src\jy901.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Core\Inc) DEBUG O
                    -BJECTEXTEND PRINT(.\Listings\jy901.lst) TABS(2) OBJECT(.\Objects\jy901.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    jy901.c
   4           * @author  sky-vocality
   5           * @version V1.0.0
   6           * @date    25-February-2021
   7           * @brief  This file is used for update jy901 data
   8           * @License:GNU General Public License v3.0         
   9           ******************************************************************************
  10           * @attention
  11           * 
  12           * 
  13           * 
  14           * 
  15           * 
  16           * 
  17           * 
  18           * 
  19           ******************************************************************************
  20          **/
  21          
  22          #include "jy901.h"
  23          
  24          JY901_InitDefine jy901;
  25          
  26          //========================================================================
  27          // Function:void jy901_update()|函数:  void jy901_update()
  28          // Description:Update jy901 data with IIC|描述:  使用IIC更新jy901的数据
  29          // Parameter:|参数:
  30          //       
  31          //       
  32          // Return:|返回: 
  33          // Version:VER1.0.0|版本: VER1.0.0
  34          // Date:2021-02-01|日期: 2021-02-01
  35          // Author: sky-vocality|作者: sky-vocality
  36          // Note:|备注:
  37          //  
  38          //  
  39          //  
  40          //  
  41          //  
  42          //========================================================================
  43          void jy901_update()
  44          {
  45   1          unsigned char p0 = 0;
  46   1          int temp = 0;
  47   1          unsigned char p1 = 0;
  48   1          Start();                                    //Send Start Command|发送起始命令
  49   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
  50   1          SendData(ROLL);
  51   1          Start();
  52   1          SendData((IICAddr<<1)|1);
  53   1          p0 = RecvData();                            //Read data 1|读取数据1
C51 COMPILER V9.60.0.0   JY901                                                             04/13/2021 19:30:18 PAGE 2   

  54   1          SendACK();
  55   1          p1 = RecvData();                            //读取数据2|读取数据2
  56   1          SendNAK();
  57   1          Stop();                                     //Send stop command|发送停止命令
  58   1          temp = (p1<<8)|p0;
  59   1          jy901.Roll = (double)temp/32768*180;
  60   1      
  61   1          Start();                                    //Send Start Command|发送起始命令
  62   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
  63   1          SendData(PITCH);
  64   1          Start();
  65   1          SendData((IICAddr<<1)|1);
  66   1          p0 = RecvData();                            //Read data 1|读取数据1
  67   1          SendACK();
  68   1          p1 = RecvData();                            //读取数据2|读取数据2
  69   1          SendNAK();
  70   1          Stop();                                     //Send stop command|发送停止命令
  71   1          temp = (p1<<8)|p0;
  72   1          jy901.Pitch = (double)temp/32768*180;
  73   1      
  74   1          Start();                                    //Send Start Command|发送起始命令
  75   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
  76   1          SendData(YAW);
  77   1          Start();
  78   1          SendData((IICAddr<<1)|1);
  79   1          p0 = RecvData();                            //Read data 1|读取数据1
  80   1          SendACK();
  81   1          p1 = RecvData();                            //读取数据2|读取数据2
  82   1          SendNAK();
  83   1          Stop();                                     //Send stop command|发送停止命令
  84   1          temp = (p1<<8)|p0;
  85   1          jy901.Yaw = (double)temp/32768*180;
  86   1      }
  87          
  88          void jy901_timer_init()
  89          {
  90   1        TIM_InitTypeDef TIM_InitTypeDef;
  91   1        TIM_InitTypeDef.TIM_Mode = TIM_16BitAutoReload;
  92   1        TIM_InitTypeDef.TIM_Polity = PolityHigh;
  93   1        TIM_InitTypeDef.TIM_Interrupt = ENABLE;
  94   1        TIM_InitTypeDef.TIM_ClkSource = TIM_CLOCK_1T;
  95   1        TIM_InitTypeDef.TIM_ClkOut = ENABLE;
  96   1        TIM_InitTypeDef.TIM_Value = 41536;
  97   1        TIM_InitTypeDef.TIM_Run = ENABLE;
  98   1        Timer_Inilize(Timer1, &TIM_InitTypeDef);
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    313    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     12      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
