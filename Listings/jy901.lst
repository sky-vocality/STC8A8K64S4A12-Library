C51 COMPILER V9.59.0.0   JY901                                                             05/04/2021 20:14:56 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE JY901
OBJECT MODULE PLACED IN .\Objects\jy901.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Core\Src\jy901.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Core\Inc) DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\jy901.lst) OBJECT(.\Objects\jy901.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    jy901.c
   4           * @author  sky-vocality
   5           * @version V1.0.0
   6           * @date    25-February-2021
   7           * @brief  This file is used for update jy901 data
   8           * @License:GNU General Public License v3.0         
   9           ******************************************************************************
  10           * @attention
  11           * 
  12           * 
  13           * 
  14           * 
  15           * 
  16           * 
  17           * 
  18           * 
  19           ******************************************************************************
  20          **/
  21          
  22          #include "jy901.h"
  23          
  24          JY901_InitDefine jy901 = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
  25          
  26          //========================================================================
  27          // Function:void jy901_update()|函数:  void jy901_update()
  28          // Description:Update jy901 data with IIC|描述:  使用IIC更新jy901的数据
  29          // Parameter:|参数:
  30          //       
  31          //       
  32          // Return:|返回: 
  33          // Version:VER1.0.0|版本: VER1.0.0
  34          // Date:2021-02-01|日期: 2021-02-01
  35          // Author: sky-vocality|作者: sky-vocality
  36          // Note:|备注:
  37          //      
  38          //      
  39          //      
  40          //      
  41          //      
  42          //========================================================================
  43          void jy901_update()
  44          {
  45   1          unsigned char p0 = 0;
  46   1          int temp = 0;
  47   1          unsigned char p1 = 0;
  48   1              P_SW2 = 0x90;
  49   1          Start();                                    //Send Start Command|发送起始命令
  50   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
  51   1          SendData(ROLL);
  52   1          Start();
  53   1          SendData((IICAddr<<1)|1);
C51 COMPILER V9.59.0.0   JY901                                                             05/04/2021 20:14:56 PAGE 2   

  54   1          p0 = RecvData();                            //Read data 1|读取数据1
  55   1          SendACK();
  56   1          p1 = RecvData();                            //读取数据2|读取数据2
  57   1          SendNAK();
  58   1          Stop();                                     //Send stop command|发送停止命令
  59   1          temp = (p1<<8)|p0;
  60   1          jy901.Roll = (double)temp/32768*180;
  61   1      
  62   1          Start();                                    //Send Start Command|发送起始命令
  63   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
  64   1          SendData(PITCH);
  65   1          Start();
  66   1          SendData((IICAddr<<1)|1);
  67   1          p0 = RecvData();                            //Read data 1|读取数据1
  68   1          SendACK();
  69   1          p1 = RecvData();                            //读取数据2|读取数据2
  70   1          SendNAK();
  71   1          Stop();                                     //Send stop command|发送停止命令
  72   1          temp = (p1<<8)|p0;
  73   1          jy901.Pitch = (double)temp/32768*180;
  74   1      
  75   1          Start();                                    //Send Start Command|发送起始命令
  76   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
  77   1          SendData(YAW);
  78   1          Start();
  79   1          SendData((IICAddr<<1)|1);
  80   1          p0 = RecvData();                            //Read data 1|读取数据1
  81   1          SendACK();
  82   1          p1 = RecvData();                            //读取数据2|读取数据2
  83   1          SendNAK();
  84   1          Stop();                                     //Send stop command|发送停止命令
  85   1              temp = (p1<<8)|p0;
  86   1          jy901.Yaw = (double)temp/32768*180;
  87   1              
  88   1              Start();                                    //Send Start Command|发送起始命令
  89   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
  90   1          SendData(GX);
  91   1          Start();
  92   1          SendData((IICAddr<<1)|1);
  93   1          p0 = RecvData();                            //Read data 1|读取数据1
  94   1          SendACK();
  95   1          p1 = RecvData();                            //读取数据2|读取数据2
  96   1          SendNAK();
  97   1          Stop();                                     //Send stop command|发送停止命令
  98   1          temp = (p1<<8)|p0;
  99   1          jy901.Gx = (double)temp/32768*2000;
 100   1              
 101   1              Start();                                    //Send Start Command|发送起始命令
 102   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
 103   1          SendData(GY);
 104   1          Start();
 105   1          SendData((IICAddr<<1)|1);
 106   1          p0 = RecvData();                            //Read data 1|读取数据1
 107   1          SendACK();
 108   1          p1 = RecvData();                            //读取数据2|读取数据2
 109   1          SendNAK();
 110   1          Stop();                                     //Send stop command|发送停止命令
 111   1          temp = (p1<<8)|p0;
C51 COMPILER V9.59.0.0   JY901                                                             05/04/2021 20:14:56 PAGE 3   

 112   1          jy901.Gy = (double)temp/32768*2000;
 113   1              
 114   1              Start();                                    //Send Start Command|发送起始命令
 115   1          SendData(IICAddr<<1);                          //Send device address + read command|发送设备地址
             -+读命令
 116   1          SendData(GZ);
 117   1          Start();
 118   1          SendData((IICAddr<<1)|1);
 119   1          p0 = RecvData();                            //Read data 1|读取数据1
 120   1          SendACK();
 121   1          p1 = RecvData();                            //读取数据2|读取数据2
 122   1          SendNAK();
 123   1          Stop();                                     //Send stop command|发送停止命令
 124   1          temp = (p1<<8)|p0;
 125   1          jy901.Gz = (double)temp/32768*2000;
 126   1          P_SW2 = 0x00;
 127   1      }
 128          
 129          void jy901_timer_init()
 130          {
 131   1              TIM_InitTypeDef TIM_InitTypeDef;
 132   1              TIM_InitTypeDef.TIM_Mode = TIM_16BitAutoReload;
 133   1              TIM_InitTypeDef.TIM_Polity = PolityHigh;
 134   1              TIM_InitTypeDef.TIM_Interrupt = ENABLE;
 135   1              TIM_InitTypeDef.TIM_ClkSource = TIM_CLOCK_1T;
 136   1              TIM_InitTypeDef.TIM_ClkOut = ENABLE;
 137   1              TIM_InitTypeDef.TIM_Value = 41536;
 138   1              TIM_InitTypeDef.TIM_Run = ENABLE;
 139   1              IIC_host_Slave_machine(host_machine);
 140   1              Timer_Inilize(Timer1, &TIM_InitTypeDef);
 141   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    594    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     24      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
